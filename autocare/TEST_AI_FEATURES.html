<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoCare - Test AI Features</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Core System -->
    <script src="core/state.js"></script>
    <script src="core/events.js"></script>
    <script src="core/ui.js"></script>
    
    <!-- Data -->
    <script src="data/marketplace-data.js"></script>
    
    <!-- AI Features -->
    <script src="features/enhanced-diagnostics.js"></script>
    <script src="features/ai-diagnostic-engine.js"></script>
    
    <style>
        .test-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 24px;
        }
        .result-box {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 9999px;
            font-size: 12px;
            font-weight: 600;
        }
        .badge-critical { background: #fee2e2; color: #991b1b; }
        .badge-high { background: #fed7aa; color: #9a3412; }
        .badge-medium { background: #fef3c7; color: #92400e; }
        .badge-low { background: #d1fae5; color: #065f46; }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <header class="mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-2">🤖 AutoCare AI Features Test</h1>
            <p class="text-gray-600">Test advanced diagnostic engine with NLP, regional pricing, and predictive maintenance</p>
        </header>

        <!-- Quick Test Buttons -->
        <div class="test-card">
            <h2 class="text-2xl font-bold mb-4">⚡ Quick Tests</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <button onclick="testPhrase('my engine is making rattling noises and smoke is coming out')" 
                    class="px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition text-left">
                    <div class="font-semibold">Engine + Smoke</div>
                    <div class="text-sm opacity-90">Complex multi-symptom</div>
                </button>
                <button onclick="testPhrase('brakes are squealing loudly and pedal feels spongy')" 
                    class="px-4 py-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition text-left">
                    <div class="font-semibold">Brake Issues</div>
                    <div class="text-sm opacity-90">Critical safety</div>
                </button>
                <button onclick="testPhrase('battery keeps dying and lights are dim')" 
                    class="px-4 py-3 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition text-left">
                    <div class="font-semibold">Electrical Problems</div>
                    <div class="text-sm opacity-90">Battery + alternator</div>
                </button>
                <button onclick="testPhrase('car overheats in traffic, AC not working, strange vibrations')" 
                    class="px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition text-left">
                    <div class="font-semibold">Multi-System Issue</div>
                    <div class="text-sm opacity-90">Complex diagnosis</div>
                </button>
            </div>
        </div>

        <!-- Custom Test -->
        <div class="test-card">
            <h2 class="text-2xl font-bold mb-4">🔧 Custom Diagnostic Test</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Region</label>
                    <select id="region-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        <option value="Nigeria">🇳🇬 Nigeria</option>
                        <option value="Kenya">🇰🇪 Kenya</option>
                        <option value="Ghana">🇬🇭 Ghana</option>
                        <option value="South Africa">🇿🇦 South Africa</option>
                        <option value="Egypt">🇪🇬 Egypt</option>
                        <option value="Tanzania">🇹🇿 Tanzania</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Language</label>
                    <select id="language-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        <option value="en">English</option>
                        <option value="sw">Swahili</option>
                        <option value="yo">Yoruba</option>
                        <option value="fr">French</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Vehicle Age (years)</label>
                    <input type="number" id="age-input" value="5" min="0" max="30" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Mileage (miles)</label>
                    <input type="number" id="mileage-input" value="50000" min="0" step="1000"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                </div>
            </div>

            <div class="mb-4">
                <label class="block text-sm font-medium mb-2">Describe the Problem</label>
                <textarea id="symptom-input" rows="3" 
                    placeholder="e.g., my engine is knocking and there's smoke..."
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg"></textarea>
            </div>

            <button onclick="runCustomTest()" 
                class="w-full px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-semibold">
                🤖 Run AI Diagnosis
            </button>

            <div id="custom-results"></div>
        </div>

        <!-- Multi-Language Tests -->
        <div class="test-card">
            <h2 class="text-2xl font-bold mb-4">🌍 Multi-Language Tests</h2>
            <div class="space-y-3">
                <button onclick="testMultiLanguage('sw', 'injini yangu inapiga na mvuke inatoka')" 
                    class="w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-left">
                    <div class="font-semibold">🇰🇪 Swahili Test</div>
                    <div class="text-sm opacity-90">"injini yangu inapiga na mvuke inatoka"</div>
                </button>
                <button onclick="testMultiLanguage('yo', 'ẹ́njìnì mi ń pariwo àti èéfín ń jáde')" 
                    class="w-full px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition text-left">
                    <div class="font-semibold">🇳🇬 Yoruba Test</div>
                    <div class="text-sm opacity-90">"ẹ́njìnì mi ń pariwo àti èéfín ń jáde"</div>
                </button>
                <button onclick="testMultiLanguage('fr', 'mon moteur fait du bruit et de la fumée sort')" 
                    class="w-full px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition text-left">
                    <div class="font-semibold">🇫🇷 French Test</div>
                    <div class="text-sm opacity-90">"mon moteur fait du bruit et de la fumée sort"</div>
                </button>
            </div>
        </div>

        <!-- Results Display -->
        <div id="results-container"></div>
    </div>

    <script>
        function testPhrase(phrase) {
            const region = document.getElementById('region-select').value;
            const language = document.getElementById('language-select').value;
            const age = parseInt(document.getElementById('age-input').value);
            const mileage = parseInt(document.getElementById('mileage-input').value);

            runDiagnosis(phrase, { region, language, vehicleAge: age, mileage });
        }

        function runCustomTest() {
            const symptom = document.getElementById('symptom-input').value.trim();
            if (!symptom) {
                alert('Please describe the problem');
                return;
            }

            const region = document.getElementById('region-select').value;
            const language = document.getElementById('language-select').value;
            const age = parseInt(document.getElementById('age-input').value);
            const mileage = parseInt(document.getElementById('mileage-input').value);

            runDiagnosis(symptom, { region, language, vehicleAge: age, mileage });
        }

        function testMultiLanguage(lang, phrase) {
            const region = lang === 'sw' ? 'Kenya' : lang === 'yo' ? 'Nigeria' : 'Ghana';
            runDiagnosis(phrase, { region, language: lang, vehicleAge: 5, mileage: 50000 });
        }

        function runDiagnosis(description, options) {
            const season = getCurrentSeason();
            const diagnosis = window.AdvancedAIDiagnosticEngine.diagnose(description, {
                ...options,
                season
            });

            displayResults(diagnosis, description, options);
        }

        function getCurrentSeason() {
            const month = new Date().getMonth();
            return (month >= 3 && month <= 9) ? 'rainy' : 'dry';
        }

        function displayResults(diagnosis, originalInput, options) {
            const container = document.getElementById('results-container');
            
            const urgencyColors = {
                critical: 'badge-critical',
                high: 'badge-high',
                medium: 'badge-medium',
                low: 'badge-low'
            };

            const urgencyIcons = {
                critical: 'alert-octagon',
                high: 'alert-triangle',
                medium: 'alert-circle',
                low: 'info'
            };

            const html = `
                <div class="test-card">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-2xl font-bold">📊 Diagnosis Results</h2>
                        <span class="badge ${urgencyColors[diagnosis.urgencyLevel?.color] || 'badge-medium'}">
                            ${diagnosis.urgencyLevel?.label || diagnosis.severity?.toUpperCase()} URGENCY
                        </span>
                    </div>

                    <!-- Input Summary -->
                    <div class="result-box mb-4">
                        <div class="text-sm font-semibold text-gray-600 mb-2">Input</div>
                        <div class="text-gray-900">"${originalInput}"</div>
                        <div class="flex gap-4 mt-2 text-sm text-gray-600">
                            <span>📍 ${options.region}</span>
                            <span>🗣️ ${options.language}</span>
                            <span>📅 ${options.vehicleAge} years</span>
                            <span>🛣️ ${options.mileage.toLocaleString()} mi</span>
                        </div>
                    </div>

                    <!-- Problem -->
                    <div class="mb-6">
                        <h3 class="text-xl font-bold text-red-600 mb-2">${diagnosis.problem}</h3>
                        <p class="text-gray-700">${diagnosis.description || 'Detailed analysis of the issue.'}</p>
                    </div>

                    <!-- Health Score -->
                    <div class="mb-6">
                        <div class="flex justify-between mb-2">
                            <span class="font-semibold">Vehicle Health Score</span>
                            <span class="font-bold text-${diagnosis.urgencyLevel?.color}-600">${diagnosis.healthScore || 50}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div class="bg-${diagnosis.urgencyLevel?.color}-500 h-3 rounded-full transition-all duration-500" 
                                style="width: ${diagnosis.healthScore || 50}%"></div>
                        </div>
                        <div class="text-sm text-gray-600 mt-1">
                            Confidence: ${Math.round((diagnosis.confidence || 0.5) * 100)}%
                        </div>
                    </div>

                    <!-- Cost Estimate -->
                    ${diagnosis.costEstimate ? `
                        <div class="result-box mb-6">
                            <h4 class="font-semibold mb-3">💰 Cost Estimate (${diagnosis.costEstimate.regional})</h4>
                            <div class="text-3xl font-bold text-gray-900 mb-2">
                                $${diagnosis.costEstimate.min} - $${diagnosis.costEstimate.max}
                            </div>
                            ${diagnosis.costEstimate.breakdown ? `
                                <div class="grid grid-cols-3 gap-2 text-sm">
                                    <div>
                                        <div class="text-gray-600">Labor</div>
                                        <div class="font-semibold">$${diagnosis.costEstimate.breakdown.labor}</div>
                                    </div>
                                    <div>
                                        <div class="text-gray-600">Parts</div>
                                        <div class="font-semibold">$${diagnosis.costEstimate.breakdown.parts}</div>
                                    </div>
                                    <div>
                                        <div class="text-gray-600">Shipping</div>
                                        <div class="font-semibold">$${diagnosis.costEstimate.breakdown.shipping}</div>
                                    </div>
                                </div>
                            ` : ''}
                            ${diagnosis.repairTime ? `
                                <div class="mt-2 text-sm text-gray-600">
                                    ⏱️ Estimated Repair Time: ${diagnosis.repairTime}
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}

                    <!-- Causes -->
                    ${diagnosis.causes && diagnosis.causes.length > 0 ? `
                        <div class="mb-6">
                            <h4 class="font-semibold mb-2">🔍 Possible Causes</h4>
                            <ul class="list-disc list-inside space-y-1 text-gray-700">
                                ${diagnosis.causes.map(cause => `<li>${cause}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}

                    <!-- Recommendations -->
                    ${diagnosis.recommendations && diagnosis.recommendations.length > 0 ? `
                        <div class="mb-6">
                            <h4 class="font-semibold mb-2">💡 Recommendations</h4>
                            <ul class="space-y-2">
                                ${diagnosis.recommendations.map(rec => `
                                    <li class="flex items-start">
                                        <i data-lucide="chevron-right" class="w-4 h-4 text-red-500 mr-2 mt-1"></i>
                                        <span class="text-gray-700">${rec}</span>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    ` : ''}

                    <!-- Predictive Maintenance -->
                    ${diagnosis.predictive ? `
                        <div class="result-box mb-6">
                            <h4 class="font-semibold mb-3">🔮 Predictive Maintenance</h4>
                            ${diagnosis.predictive.upcoming && diagnosis.predictive.upcoming.length > 0 ? `
                                <div class="space-y-2">
                                    ${diagnosis.predictive.upcoming.map(item => `
                                        <div class="flex justify-between items-center p-2 bg-white rounded">
                                            <div>
                                                <div class="font-medium">${item.item}</div>
                                                <div class="text-sm text-gray-600">${item.reason}</div>
                                            </div>
                                            <div class="text-right">
                                                <div class="text-sm font-semibold text-${item.priority === 'high' ? 'red' : 'yellow'}-600">
                                                    ${item.priority.toUpperCase()}
                                                </div>
                                                <div class="text-xs text-gray-500">${item.dueIn}</div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}

                    <!-- Regional Insights -->
                    ${diagnosis.regional ? `
                        <div class="result-box">
                            <h4 class="font-semibold mb-3">🌍 Regional Insights (${diagnosis.regional.region})</h4>
                            ${diagnosis.regional.localTips && diagnosis.regional.localTips.length > 0 ? `
                                <ul class="space-y-1 text-sm text-gray-700">
                                    ${diagnosis.regional.localTips.map(tip => `
                                        <li class="flex items-start">
                                            <span class="mr-2">•</span>
                                            <span>${tip}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                            ` : ''}
                        </div>
                    ` : ''}

                    <!-- Feedback ID -->
                    <div class="mt-4 text-xs text-gray-500">
                        Feedback ID: ${diagnosis.feedbackId || 'N/A'}
                    </div>
                </div>
            `;

            container.innerHTML = html;
            
            // Reinitialize icons
            if (window.lucide) {
                window.lucide.createIcons();
            }

            // Scroll to results
            container.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Initialize
        window.addEventListener('load', () => {
            console.log('=== AutoCare AI Features Test ===');
            console.log('Advanced Engine:', !!window.AdvancedAIDiagnosticEngine);
            console.log('Enhanced Engine:', !!window.EnhancedDiagnosticEngine);
            
            if (window.lucide) {
                window.lucide.createIcons();
            }
        });
    </script>
</body>
</html>
